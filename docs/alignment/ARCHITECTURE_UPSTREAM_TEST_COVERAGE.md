# Architecture Upstream Test Coverage (Mermaid@11.12.2)

This document tracks which upstream Mermaid architecture parser tests are covered in `merman` via:

- snapshot fixtures under `fixtures/architecture/*.mmd` (goldens generated by `cargo run -p xtask -- update-snapshots`)
- Rust unit tests under `crates/merman-core/src/diagrams/architecture.rs`
- upstream SVG baselines under `fixtures/upstream-svgs/architecture/*.svg` (generated by `cargo run -p xtask -- gen-upstream-svgs --diagram architecture`)
- SVG DOM compare via `cargo run -p xtask -- compare-architecture-svgs --check-dom --dom-mode parity --dom-decimals 3`

Scope: Mermaid tag `@11.12.2`.

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/architecture/architecture.spec.ts`

- header keyword: `fixtures/architecture/upstream_architecture_header_only_spec.mmd`
- simple service statement: `fixtures/architecture/upstream_architecture_simple_service_spec.mmd`
- title on header line: `fixtures/architecture/upstream_architecture_title_first_line_spec.mmd`
- title on separate line: `fixtures/architecture/upstream_architecture_title_other_line_spec.mmd`
- accessibility title + description: `fixtures/architecture/upstream_architecture_acc_title_and_descr_spec.mmd`
- multiline accessibility description: `fixtures/architecture/upstream_architecture_multiline_acc_descr_spec.mmd`

Source: `repo-ref/mermaid/docs/syntax/architecture.md`

The following fixtures are derived from the official syntax documentation and primarily cover
edge syntax (ports, titles, arrows, group boundary traversal), nesting, and junction statements.

Note: they are currently marked as parser-only fixtures (filename contains `_parser_only_`) so
they are excluded from layout snapshots and SVG DOM parity compares while the Architecture layout
and renderer are still being brought up.

- docs example (group + services + edges): `fixtures/architecture/upstream_architecture_docs_example_parser_only_.mmd`
- edge arrows (`-->`, `<--`, `<-->`): `fixtures/architecture/upstream_architecture_docs_edge_arrows_parser_only_.mmd`
- edge titles (`-[label]-`, `-[label]->`): `fixtures/architecture/upstream_architecture_docs_edge_titles_parser_only_.mmd`
- edges out of groups (`{group}` modifier): `fixtures/architecture/upstream_architecture_docs_group_edges_parser_only_.mmd`
- groups within groups + edges: `fixtures/architecture/upstream_architecture_docs_groups_within_groups_parser_only_.mmd`
- junction statements + edges: `fixtures/architecture/upstream_architecture_docs_junctions_parser_only_.mmd`
- service icon vs. iconText string: `fixtures/architecture/upstream_architecture_docs_service_icon_text_parser_only_.mmd`

Additional stress case (parser-only):

- tall-ish nested layout input for future viewport/height parity work: `fixtures/architecture/upstream_architecture_layout_reasonable_height_parser_only_.mmd`

Source: `repo-ref/mermaid/cypress/integration/rendering/architecture.spec.ts`

These fixtures are derived from the (currently skipped) Cypress rendering suite and cover a broader
set of real-world inputs, including shorthand edge syntax that appears in examples:

- groups + services + shorthand edges (`db L--R server`): `fixtures/architecture/upstream_architecture_cypress_groups_parser_only_.mmd`
- title + accessibility + colon-style ports: `fixtures/architecture/upstream_architecture_cypress_title_and_accessibilities_parser_only_.mmd`
- nested groups within groups: `fixtures/architecture/upstream_architecture_cypress_groups_within_groups_parser_only_.mmd`
- fallback icon handling: `fixtures/architecture/upstream_architecture_cypress_fallback_icon_parser_only_.mmd`
- split directioning (mixed port pairs): `fixtures/architecture/upstream_architecture_cypress_split_directioning_parser_only_.mmd`
- directional arrows via parenthesized port pairs (`(L--R)`): `fixtures/architecture/upstream_architecture_cypress_directional_arrows_parser_only_.mmd`
- group boundary traversal edges (`{group}` modifier): `fixtures/architecture/upstream_architecture_cypress_group_edges_parser_only_.mmd`
- edge label shorthand (`L-[Label]-R`): `fixtures/architecture/upstream_architecture_cypress_edge_labels_parser_only_.mmd`
- simple junction edges: `fixtures/architecture/upstream_architecture_cypress_simple_junction_edges_parser_only_.mmd`
- “reasonable height” stress case (parser-only): `fixtures/architecture/upstream_architecture_cypress_reasonable_height_parser_only_.mmd`

Known missing Cypress case (not yet captured as a fixture):

- complex junction edges use a multi-line parenthesized edge syntax (parenthesis spans multiple lines),
  which is not yet supported by the Rust parser. Once supported, add a fixture for that scenario.
