# Architecture Upstream Test Coverage (Mermaid@11.12.2)

This document tracks which upstream Mermaid architecture parser tests are covered in `merman` via:

- snapshot fixtures under `fixtures/architecture/*.mmd` (goldens generated by `cargo run -p xtask -- update-snapshots`)
- Rust unit tests under `crates/merman-core/src/diagrams/architecture.rs`
- upstream SVG baselines under `fixtures/upstream-svgs/architecture/*.svg` (generated by `cargo run -p xtask -- gen-upstream-svgs --diagram architecture`)
- SVG DOM compare via `cargo run -p xtask -- compare-architecture-svgs --check-dom --dom-mode parity-root --dom-decimals 3`

Scope: Mermaid tag `@11.12.2`.

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/architecture/architecture.spec.ts`

- header keyword: `fixtures/architecture/upstream_architecture_header_only_spec.mmd`
- simple service statement: `fixtures/architecture/upstream_architecture_simple_service_spec.mmd`
- title on header line: `fixtures/architecture/upstream_architecture_title_first_line_spec.mmd`
- title on separate line: `fixtures/architecture/upstream_architecture_title_other_line_spec.mmd`
- accessibility title + description: `fixtures/architecture/upstream_architecture_acc_title_and_descr_spec.mmd`
- multiline accessibility description: `fixtures/architecture/upstream_architecture_multiline_acc_descr_spec.mmd`

Source: `repo-ref/mermaid/docs/syntax/architecture.md`

The following fixtures are derived from the official syntax documentation and primarily cover
edge syntax (ports, titles, arrows, group boundary traversal), nesting, and junction statements.

Note: most of these fixtures are currently marked as parser-only (filename contains `_parser_only_`)
so they are excluded from layout snapshots and SVG DOM parity compares while the Architecture layout
and renderer are still being brought up. Promoted fixtures will have the suffix removed.

- docs example (group + services + edges): `fixtures/architecture/upstream_architecture_docs_example.mmd`
- edge arrows (`-->`, `<--`, `<-->`): `fixtures/architecture/upstream_architecture_docs_edge_arrows.mmd`
- edge titles (`-[label]-`, `-[label]->`): `fixtures/architecture/upstream_architecture_docs_edge_titles.mmd`
- edges out of groups (`{group}` modifier): `fixtures/architecture/upstream_architecture_docs_group_edges.mmd`
- groups within groups + edges: `fixtures/architecture/upstream_architecture_docs_groups_within_groups.mmd`
- junction statements + edges: `fixtures/architecture/upstream_architecture_docs_junctions.mmd`
- service icon vs. iconText string: `fixtures/architecture/upstream_architecture_docs_service_icon_text.mmd`

Additional stress case (parser-only):

- tall-ish nested layout input for future viewport/height parity work: `fixtures/architecture/upstream_architecture_layout_reasonable_height.mmd`

Source: `repo-ref/mermaid/cypress/integration/rendering/architecture.spec.ts`

These fixtures are derived from the Cypress rendering suite and cover a broader set of real-world
inputs, including shorthand edge syntax that appears in examples. Some Cypress strings are not
renderable by Mermaid CLI `@11.12.2`; for those, we keep parser-only fixtures plus CLI-compatible
normalized variants.

- groups + services + shorthand edges (`db L--R server`): `fixtures/architecture/upstream_architecture_cypress_groups_parser_only_.mmd`
- title + accessibility + colon-style ports: `fixtures/architecture/upstream_architecture_cypress_title_and_accessibilities.mmd`
- nested groups within groups: `fixtures/architecture/upstream_architecture_cypress_groups_within_groups_parser_only_.mmd`
- fallback icon handling: `fixtures/architecture/upstream_architecture_cypress_fallback_icon.mmd`
- split directioning (mixed port pairs): `fixtures/architecture/upstream_architecture_cypress_split_directioning_parser_only_.mmd`
- directional arrows via parenthesized port pairs (`(L--R)`): `fixtures/architecture/upstream_architecture_cypress_directional_arrows_parser_only_.mmd`
- group boundary traversal edges (`{group}` modifier): `fixtures/architecture/upstream_architecture_cypress_group_edges_parser_only_.mmd`
- edge label shorthand (`L-[Label]-R`): `fixtures/architecture/upstream_architecture_cypress_edge_labels_parser_only_.mmd`
- simple junction edges: `fixtures/architecture/upstream_architecture_cypress_simple_junction_edges_parser_only_.mmd`
- complex junction edges (unbalanced parenthesis in shorthand ports): `fixtures/architecture/upstream_architecture_cypress_complex_junction_edges_parser_only_.mmd`
- “reasonable height” stress case: `fixtures/architecture/upstream_architecture_cypress_reasonable_height.mmd`

Direct Cypress (raw formatting) fixtures (parity-gated with upstream SVG baselines):

- title + accessibility (raw indentation preserved):
  `fixtures/architecture/upstream_cypress_architecture_spec_should_render_a_simple_architecture_diagram_with_titleandaccessi_002.mmd`
- fallback icon (raw indentation preserved):
  `fixtures/architecture/upstream_cypress_architecture_spec_should_render_an_architecture_diagram_with_the_fallback_icon_004.mmd`
- “reasonable height” (raw indentation preserved):
  `fixtures/architecture/upstream_cypress_architecture_spec_should_render_an_architecture_diagram_with_a_reasonable_height_011.mmd`

Normalized (Langium grammar) variants:

The Cypress suite mixes shorthand syntax (which Mermaid CLI `@11.12.2` renders as an error SVG)
and newer Langium syntax. For end-to-end CLI baselines + DOM parity, we keep the raw Cypress strings as
`*_parser_only_` fixtures and add normalized variants that use the Mermaid@11.12.2 grammar:

- normalized groups: `fixtures/architecture/upstream_architecture_cypress_groups_normalized.mmd`
- normalized nested groups: `fixtures/architecture/upstream_architecture_cypress_groups_within_groups_normalized.mmd`
- normalized split directioning: `fixtures/architecture/upstream_architecture_cypress_split_directioning_normalized.mmd`
- normalized directional arrows: `fixtures/architecture/upstream_architecture_cypress_directional_arrows_normalized.mmd`
- normalized group traversal edges: `fixtures/architecture/upstream_architecture_cypress_group_edges_normalized.mmd`
- normalized edge labels: `fixtures/architecture/upstream_architecture_cypress_edge_labels_normalized.mmd`
- normalized simple junction edges: `fixtures/architecture/upstream_architecture_cypress_simple_junction_edges_normalized.mmd`
- normalized complex junction edges: `fixtures/architecture/upstream_architecture_cypress_complex_junction_edges_normalized.mmd`

Source: `repo-ref/mermaid/cypress/integration/other/xss.spec.js`

- sanitize icon labels in architecture diagrams:
  `fixtures/architecture/upstream_cypress_other_xss_spec_icon_labels_architecture_001.mmd`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/architecture/svgDraw.spec.ts`

- SVG id coverage for group/service/edge nodes:
  `fixtures/architecture/upstream_architecture_svgdraw_ids_spec.mmd`

Source: `repo-ref/mermaid/demos/architecture.html`

The architecture demo page contains additional stable, production-facing examples that are not
fully represented in parser/spec snapshots. We track these as fixture-level parity inputs:

- bidirectional arrow mesh (`<-->`) across center + diagonal adjacency:
  `fixtures/architecture/upstream_architecture_demo_arrow_mesh_bidirectional.mmd`
- long edge labels (`-[Label that is Long]-`) across multiple directions:
  `fixtures/architecture/upstream_architecture_demo_edge_label_long.mmd`
- short edge labels (`-[Label]-`) across multiple directions:
  `fixtures/architecture/upstream_architecture_demo_edge_label_short.mmd`
- basic junction routing (multiple incoming/outgoing on two junctions):
  `fixtures/architecture/upstream_architecture_demo_junction_basic.mmd`
- grouped junction routing with mixed arrow directions (`<--`, `-->`, `{group}`):
  `fixtures/architecture/upstream_architecture_demo_junction_groups_arrows.mmd`
- inverse bidirectional arrow mesh variant (top/bottom to side anchors):
  `fixtures/architecture/upstream_architecture_demo_arrow_mesh_bidirectional_inverse.mmd`
- group-edge bidirectional arrows (`<-->`) with `{group}` modifiers:
  `fixtures/architecture/upstream_architecture_demo_group_edges_bidirectional.mmd`

Source: `repo-ref/mermaid/docs/syntax/architecture.md`

- icon-pack example (logos namespace) promoted as parity fixture:
  `fixtures/architecture/upstream_architecture_docs_icons_example.mmd`
- docs code blocks imported with index-based naming (content-equivalent to the non-indexed docs fixtures):
  - `fixtures/architecture/upstream_docs_architecture_example_002.mmd`
  - `fixtures/architecture/upstream_docs_architecture_icons_018.mmd`

## HTML demo fixtures (imported)

Source: `repo-ref/mermaid/demos/architecture.html` (via `<pre class="mermaid">` blocks).

- `fixtures/architecture/upstream_html_demos_architecture_simple_diagram_with_groups_001.mmd`
- `fixtures/architecture/upstream_html_demos_architecture_groups_within_groups_002.mmd`
- `fixtures/architecture/upstream_html_demos_architecture_default_icon_from_unknown_icon_name_003.mmd`
- `fixtures/architecture/upstream_html_demos_architecture_split_direction_004.mmd`
- `fixtures/architecture/upstream_html_demos_architecture_arrow_tests_005.mmd`
- `fixtures/architecture/upstream_html_demos_architecture_arrow_tests_006.mmd`
- `fixtures/architecture/upstream_html_demos_architecture_group_edges_007.mmd`
- `fixtures/architecture/upstream_html_demos_architecture_edge_label_test_008.mmd`
- `fixtures/architecture/upstream_html_demos_architecture_edge_label_test_009.mmd`
- `fixtures/architecture/upstream_html_demos_architecture_junction_demo_010.mmd`
- `fixtures/architecture/upstream_html_demos_architecture_junction_demo_groups_011.mmd`
- `fixtures/architecture/upstream_html_demos_architecture_external_icons_demo_012.mmd`

## Authored stress fixtures

These fixtures are authored (not imported) to exercise architecture layout and renderer parity for
dense graphs, nested groups, junction routing, and mixed service forms while keeping the global
`parity-root` gate green.

- `fixtures/architecture/stress_architecture_dense_mesh_001.mmd`
- `fixtures/architecture/stress_architecture_nested_groups_002.mmd`
- `fixtures/architecture/stress_architecture_junction_star_003.mmd`
- `fixtures/architecture/stress_architecture_group_boundary_traversal_004.mmd`
- `fixtures/architecture/stress_architecture_external_icons_005.mmd`
- `fixtures/architecture/stress_architecture_long_labels_006.mmd`
- `fixtures/architecture/stress_architecture_ports_and_arrows_007.mmd`
- `fixtures/architecture/stress_architecture_grouped_junctions_008.mmd`
- `fixtures/architecture/stress_architecture_mixed_service_forms_009.mmd`
- `fixtures/architecture/stress_architecture_multi_level_groups_010.mmd`
- `fixtures/architecture/stress_architecture_wide_graph_011.mmd`
- `fixtures/architecture/stress_architecture_edge_label_corner_cases_012.mmd`
- `fixtures/architecture/stress_architecture_deep_nesting_013.mmd`
- `fixtures/architecture/stress_architecture_junction_mesh_014.mmd`
- `fixtures/architecture/stress_architecture_disconnected_components_015.mmd`
- `fixtures/architecture/stress_architecture_parallel_edges_016.mmd`
- `fixtures/architecture/stress_architecture_group_port_edges_017.mmd`
- `fixtures/architecture/stress_architecture_long_group_titles_018.mmd`
- `fixtures/architecture/stress_architecture_unicode_and_xml_escapes_019.mmd`
- `fixtures/architecture/stress_architecture_bidirectional_boundary_traversal_020.mmd`
- `fixtures/architecture/stress_architecture_fan_in_out_021.mmd`
- `fixtures/architecture/stress_architecture_multi_group_crosslinks_022.mmd`
- `fixtures/architecture/stress_architecture_nested_junctions_023.mmd`
- `fixtures/architecture/stress_architecture_cycle_with_junctions_024.mmd`
- `fixtures/architecture/stress_architecture_many_small_groups_025.mmd`
- `fixtures/architecture/stress_architecture_junction_fork_join_026.mmd`
- `fixtures/architecture/stress_architecture_deep_group_chain_027.mmd`
- `fixtures/architecture/stress_architecture_crossing_edges_ring_028.mmd`
- `fixtures/architecture/stress_architecture_ports_matrix_029.mmd`
- `fixtures/architecture/stress_architecture_long_ids_030.mmd`
- `fixtures/architecture/stress_architecture_bidirectional_arrows_031.mmd`
- `fixtures/architecture/stress_architecture_disconnected_group_edges_032.mmd`
- `fixtures/architecture/stress_architecture_mixed_icons_and_text_033.mmd`
- `fixtures/architecture/stress_architecture_group_to_group_multi_034.mmd`
- `fixtures/architecture/stress_architecture_dense_junction_grid_035.mmd`
- `fixtures/architecture/stress_architecture_edge_titles_oneword_036.mmd`
