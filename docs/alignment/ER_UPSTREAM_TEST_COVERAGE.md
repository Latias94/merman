# ER Upstream Test Coverage (Mermaid@11.12.2)

This document tracks which upstream Mermaid `erDiagram` tests are covered in `merman` via:

- snapshot fixtures under `fixtures/er/*.mmd` (goldens generated by `cargo run -p xtask -- update-snapshots`)
- Rust unit tests under `crates/merman-core/src/lib.rs`

Scope: Mermaid tag `@11.12.2`.

## `parser/erDiagram.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/er/parser/erDiagram.spec.js`

### Standalone entities

- stand-alone entities with no relationships: `fixtures/er/upstream_standalone_entities.mmd` and unit test `parse_diagram_er_allows_standalone_entities` in `crates/merman-core/src/lib.rs`

### Entity name rules

- empty quoted entity name `""` rejected: unit test `parse_diagram_er_empty_quoted_entity_name_is_error` in `crates/merman-core/src/lib.rs`
- `%` and `\\` rejected in quoted names: unit test `parse_diagram_er_rejects_percent_and_backslash_in_quoted_entity_name` in `crates/merman-core/src/lib.rs`
- allow `-` / `_` in unquoted names: unit test `parse_diagram_er_allows_hyphen_and_underscore_in_unquoted_entity_name` in `crates/merman-core/src/lib.rs`
- reject unquoted entity names with disallowed punctuation: unit test `parse_diagram_er_rejects_unquoted_entity_names_with_non_identifier_punctuation` in `crates/merman-core/src/lib.rs`
- prototype-like entity names (`__proto__`, etc): unit test `parse_diagram_er_allows_prototype_like_entity_names` in `crates/merman-core/src/lib.rs`

### Aliases

- entity alias via `foo["bar"]`: unit test `parse_diagram_er_parses_alias_and_attributes` in `crates/merman-core/src/lib.rs`
- alias applies even when relationship is defined before/after: `fixtures/er/upstream_alias_relationship_order.mmd` and unit test `parse_diagram_er_alias_applies_even_when_relationship_is_defined_first` in `crates/merman-core/src/lib.rs`

### Attributes

- attribute name rules (`[]`, `()`, `*` prefix): unit tests
  - `parse_diagram_er_supports_attribute_name_brackets_and_parens`
  - `parse_diagram_er_allows_asterisk_at_start_of_attribute_name`
  - `parse_diagram_er_rejects_attribute_names_with_leading_numbers_dashes_or_brackets`
- attribute types (generic `~T~`, arrays, `varchar(5)`): unit test `parse_diagram_er_supports_generic_and_array_and_limited_length_types`
- constraints + comments: `fixtures/er/upstream_attributes_styles_classes.mmd` and unit tests
  - `parse_diagram_er_parses_many_constraints_and_comments`
  - `parse_diagram_er_supports_empty_attribute_blocks_and_multiple_blocks`
- multiple attribute blocks + empty blocks + whitespace variants: `fixtures/er/upstream_attribute_blocks_whitespace_spec.mmd`

### Relationships

- basic relationship parsing and dedup behavior: `fixtures/er/basic.mmd`
- multiple relationships between the same entities: unit test `parse_diagram_er_allows_multiple_relationships_between_same_two_entities`
- relationship matrix + word alias matrix (cardinality + identifying/non-identifying): unit tests
  - `parse_diagram_er_relationship_matrix_matches_upstream_spec_minimally`
  - `parse_diagram_er_relationship_word_aliases_match_upstream_spec_minimally`
  - representative snapshot: `fixtures/er/upstream_relationship_aliases.mmd`
- recursive + multi-relationship + numeric/word cardinality variants: `fixtures/er/upstream_relationship_variants_spec.mmd`
- numeric cardinality shorthands (`1+`, `0+`, `1`): unit test `parse_diagram_er_supports_numeric_cardinality_shorthands`
- parent-child relationship mapping (`MD_PARENT`): unit test `parse_diagram_er_parent_child_relationship_sets_md_parent_cardinality`
- invalid relationship syntax rejected: unit test `parse_diagram_er_rejects_invalid_relationship_syntax`

### Styles and classes

- `style` statement: unit tests
  - `parse_diagram_er_style_statement_applies_styles`
  - `parse_diagram_er_style_statements_append_across_multiple_lines`
- `classDef` and `class` statements: unit tests
  - `parse_diagram_er_class_statement_assigns_classes`
  - `parse_diagram_er_class_statement_appends_across_multiple_lines`
  - `parse_diagram_er_classdef_defines_styles_and_text_styles`
  - `parse_diagram_er_classdef_supports_multiple_classes_in_one_statement`
- shorthand `:::class` variants (entity-only, empty block, with attributes, multiple classes, alias, and in relationships):
  - unit tests `parse_diagram_er_shorthand_class_assignment_variants_work`
  - `parse_diagram_er_shorthand_assignment_supports_multiple_classes_and_alias`
  - `parse_diagram_er_shorthand_assignment_works_in_relationships`
  - representative snapshot: `fixtures/er/upstream_attributes_styles_classes.mmd`
- default class definition (`classDef default ...`): `fixtures/er/upstream_default_class_spec.mmd`

### Accessibility

- `accTitle:` + multiline `accDescr{...}`: `fixtures/er/upstream_accessibility_multiline_spec.mmd` and unit test `parse_diagram_er_acc_title_and_multiline_description` in `crates/merman-core/src/lib.rs`

### Quoted entity names

- quoted entity names with punctuation (except `%` and `\\`): `fixtures/er/upstream_quoted_entity_names_spec.mmd`

## `erRenderer.spec.ts` (rendering)

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/er/erRenderer.spec.ts`

- renderer-only (SVG / id generation for rendering) and out of scope for headless parsing parity.
