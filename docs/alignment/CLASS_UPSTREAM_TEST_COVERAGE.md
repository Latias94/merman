# Class Diagram Upstream Test Coverage (Mermaid@11.12.2)

This document tracks which upstream Mermaid `classDiagram` tests are covered in `merman` via:

- snapshot fixtures under `fixtures/class/*.mmd` (goldens generated by `cargo run -p xtask -- update-snapshots`)
- Rust unit tests under `crates/merman-core/src/lib.rs`

Scope: Mermaid tag `@11.12.2`.

## `parser/class.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/class/parser/class.spec.js`

- prototype properties (`__proto__`, `constructor`) must not crash: `fixtures/class/upstream_parser_class_spec.mmd`
- backtick escaping in namespace/class names: `fixtures/class/upstream_parser_class_spec.mmd`

## `classDiagram-styles.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/class/classDiagram-styles.spec.js`

- css class shorthand (`class X:::cls`): `fixtures/class/upstream_styles_spec.mmd` and unit test `parse_diagram_class_css_class_shorthand` in `crates/merman-core/src/lib.rs`
- `cssClass "A,B" cls` assignment: `fixtures/class/upstream_styles_spec.mmd`
- `style <Class> ...` sets node styles: `fixtures/class/upstream_styles_spec.mmd` and unit test `parse_diagram_class_style_statement_sets_node_styles` in `crates/merman-core/src/lib.rs`
- `classDef` styles apply to classes with that css class: `fixtures/class/upstream_styles_spec.mmd` and unit test `parse_diagram_class_classdef_applies_styles_to_css_classes` in `crates/merman-core/src/lib.rs`

## `classDiagram.spec.ts`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/class/classDiagram.spec.ts`

- namespaces + parent assignment: `fixtures/class/upstream_namespaces_and_generics.mmd` and unit test `parse_diagram_class_namespace_and_generic_methods` in `crates/merman-core/src/lib.rs`
- generic class `~T~` and method return formatting: `fixtures/class/upstream_namespaces_and_generics.mmd`
- direction + relation label parsing: `fixtures/class/upstream_namespaces_and_generics.mmd` and unit test `parse_diagram_class_relation_with_label_and_direction`
- accTitle + multiline accDescr: `fixtures/class/upstream_namespaces_and_generics.mmd`
- backticked class names + dash/underscore identifiers: `fixtures/class/upstream_names_backticks_dash_underscore_spec.mmd`
- `classDiagram-v2` header: `fixtures/class/upstream_header_classdiagram_v2_spec.mmd`
- cross-namespace relations (relations before/after namespaces): `fixtures/class/upstream_cross_namespace_relations_spec.mmd`
- separators inside member blocks: `fixtures/class/upstream_separators_labels_notes.mmd`
- text labels + annotations + member statements: `fixtures/class/upstream_separators_labels_notes.mmd` and unit test `parse_diagram_class_text_label_member_annotation_and_css_classes`
- annotations inside member blocks: `fixtures/class/upstream_annotations_in_brackets_spec.mmd`
- text label variants (punctuation/unicode): `fixtures/class/upstream_text_label_variants_spec.mmd`
- relation types + cardinalities + labels: `fixtures/class/upstream_relation_types_and_cardinalities_spec.mmd`
- notes (`note for`, unattached `note`): `fixtures/class/upstream_separators_labels_notes.mmd`
- notes with keywords in text: `fixtures/class/upstream_note_keywords_spec.mmd`

## Interactivity and security-level behavior

Source files:
- `repo-ref/mermaid/packages/mermaid/src/diagrams/class/classDb.ts`

- href sanitization when `securityLevel != loose`: `fixtures/class/upstream_interactivity.mmd` and unit test `parse_diagram_class_href_sanitizes_javascript_urls_when_not_loose`
- click href target + tooltip: `fixtures/class/upstream_interactivity_click_href_target_spec.mmd`
- click call with callback args + tooltip: `fixtures/class/upstream_interactivity_click_call_with_args_spec.mmd`
- `securityLevel = loose` snapshot (callbackEffective + JS href allowed): `fixtures/class/upstream_interactivity_security_level_loose_spec.mmd`
- sandbox target coercion (`_top`): unit test `parse_diagram_class_security_level_sandbox_forces_link_target_top`
- `securityLevel = sandbox` snapshot (forces `_top`): `fixtures/class/upstream_interactivity_security_level_sandbox_target_top_spec.mmd`
- callback effective when `securityLevel = loose`: unit test `parse_diagram_class_security_level_loose_marks_callback_effective`

## Rendering-only / deferred

- `classTypes.spec.ts`, `svgDraw.spec.js`: rendering/layout-focused behavior and not part of headless parsing parity.
