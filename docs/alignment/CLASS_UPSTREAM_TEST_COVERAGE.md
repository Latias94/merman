# Class Diagram Upstream Test Coverage (Mermaid@11.12.2)

This document tracks which upstream Mermaid `classDiagram` tests are covered in `merman` via:

- snapshot fixtures under `fixtures/class/*.mmd` (goldens generated by `cargo run -p xtask -- update-snapshots`)
- Rust unit tests under `crates/merman-core/src/lib.rs`
- headless layout tests and debug SVG exports under `crates/merman-render`

Scope: Mermaid tag `@11.12.2`.

## External regression cases

These fixtures are sourced from downstream renderer reports (outside Mermaid's own test suite) and
are parity-gated against upstream SVG baselines:

- mmdr test fixture (basic): `fixtures/class/mmdr_tests_class_class_basic.mmd`
- mmdr test fixture (multiplicity): `fixtures/class/mmdr_tests_class_class_multiplicity.mmd`

Reference: `docs/alignment/EXTERNAL_FIXTURES.md`.

## `parser/class.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/class/parser/class.spec.js`

- prototype properties (`__proto__`, `constructor`) must not crash: `fixtures/class/upstream_parser_class_spec.mmd`
- backtick escaping in namespace/class names: `fixtures/class/upstream_parser_class_spec.mmd`

## `classDiagram-styles.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/class/classDiagram-styles.spec.js`

- css class shorthand (`class X:::cls`): `fixtures/class/upstream_styles_spec.mmd` and unit test `parse_diagram_class_css_class_shorthand` in `crates/merman-core/src/lib.rs`
- `cssClass "A,B" cls` assignment: `fixtures/class/upstream_styles_spec.mmd`
- `style <Class> ...` sets node styles: `fixtures/class/upstream_styles_spec.mmd` and unit test `parse_diagram_class_style_statement_sets_node_styles` in `crates/merman-core/src/lib.rs`
- `classDef` styles apply to classes with that css class: `fixtures/class/upstream_styles_spec.mmd` and unit test `parse_diagram_class_classdef_applies_styles_to_css_classes` in `crates/merman-core/src/lib.rs`

## `classDiagram.spec.ts`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/class/classDiagram.spec.ts`

- namespaces + parent assignment: `fixtures/class/upstream_namespaces_and_generics.mmd` and unit test `parse_diagram_class_namespace_and_generic_methods` in `crates/merman-core/src/lib.rs`
- generic class `~T~` and method return formatting: `fixtures/class/upstream_namespaces_and_generics.mmd`
- direction + relation label parsing: `fixtures/class/upstream_namespaces_and_generics.mmd` and unit test `parse_diagram_class_relation_with_label_and_direction`
- accTitle + multiline accDescr: `fixtures/class/upstream_namespaces_and_generics.mmd`
- backticked class names + dash/underscore identifiers: `fixtures/class/upstream_names_backticks_dash_underscore_spec.mmd`
- `classDiagram-v2` header: `fixtures/class/upstream_header_classdiagram_v2_spec.mmd`
- cross-namespace relations (relations before/after namespaces): `fixtures/class/upstream_cross_namespace_relations_spec.mmd`
- separators inside member blocks: `fixtures/class/upstream_separators_labels_notes.mmd`
- text labels + annotations + member statements: `fixtures/class/upstream_separators_labels_notes.mmd` and unit test `parse_diagram_class_text_label_member_annotation_and_css_classes`
- annotations inside member blocks: `fixtures/class/upstream_annotations_in_brackets_spec.mmd`
- text label variants (punctuation/unicode): `fixtures/class/upstream_text_label_variants_spec.mmd`
- relation types + cardinalities + labels: `fixtures/class/upstream_relation_types_and_cardinalities_spec.mmd`
- notes (`note for`, unattached `note`): `fixtures/class/upstream_separators_labels_notes.mmd`
- notes with keywords in text: `fixtures/class/upstream_note_keywords_spec.mmd`

## Cypress rendering fixtures (`cypress/integration/rendering`)

Source: `repo-ref/mermaid/cypress/integration/rendering/classdiagram*.spec.{js,ts}`

These fixtures are parity-gated against upstream SVG baselines under `fixtures/upstream-svgs/class/` via:

- `cargo run --release -p xtask -- compare-class-svgs --check-dom --dom-mode parity-root --dom-decimals 3`

Imported fixtures:

- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_1_1_should_render_a_simple_class_diagram_without_htmllabels_003.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_10_should_render_a_simple_class_diagram_with_clickable_callb_018.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_16b_should_handle_the_direction_statement_with_tb_027.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_17a_should_handle_the_direction_statement_with_bt_028.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_18a_should_handle_the_direction_statement_with_lr_030.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_2_1_should_render_a_simple_class_diagrams_with_cardinality_w_005.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_4_should_render_a_simple_class_diagram_with_comments_009.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_9_should_render_a_simple_class_diagram_with_clickable_link_017.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_should_render_a_full_class_diagram_using_elk_057.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_should_render_a_simple_class_diagram_with_a_custom_theme_055.mmd`
- `fixtures/class/upstream_cypress_classdiagram_spec_should_handle_newline_title_in_namespace_021.mmd`
- `fixtures/class/upstream_cypress_classdiagram_spec_should_render_class_diagram_with_newlines_in_title_018.mmd`
- `fixtures/class/upstream_cypress_classdiagram_spec_should_render_with_newlines_in_title_and_an_annotation_020.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_1_should_render_a_simple_class_diagram_002.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_10_should_render_a_simple_class_diagram_with_clickable_callback_012.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_2_should_render_a_simple_class_diagrams_with_cardinality_003.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_4_should_render_a_simple_class_diagram_with_comments_006.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_9_should_render_a_simple_class_diagram_with_clickable_link_011.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_renders_a_class_diagram_with_nested_namespaces_and_relationships_035.mmd`

Batch 2026-02-16 (complex, 8 fixtures; imported via `xtask import-upstream-cypress --diagram class --with-baselines --complex --limit 30`):

- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_5_1_should_render_a_simple_class_diagram_with_abstract_metho_011.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_6_1_should_render_a_simple_class_diagram_with_static_method_013.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_should_render_a_class_with_text_label_033.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_should_render_a_simple_class_diagram_with_no_members_040.mmd`
- `fixtures/class/upstream_cypress_classdiagram_handdrawn_v3_spec_hd_should_render_a_class_with_text_label_033.mmd`
- `fixtures/class/upstream_cypress_classdiagram_handdrawn_v3_spec_hd_should_render_classlabel_if_class_has_already_been_defined_ea_038.mmd`
- `fixtures/class/upstream_cypress_classdiagram_spec_should_handle_an_empty_class_body_with_empty_braces_029.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_should_render_a_simple_class_diagram_with_no_members_032.mmd`

Batch 2026-02-15 (complex, 25 fixtures; imported via `xtask import-upstream-cypress --diagram class --with-baselines --limit 25 --complex`):

- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_11_1_should_render_a_simple_class_diagram_with_return_type_o_020.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_1433_should_render_a_simple_class_with_a_title_032.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_15_should_render_a_simple_class_diagram_with_css_classes_app_025.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_16a_should_render_a_simple_class_diagram_with_static_field_026.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_should_render_a_simple_class_diagram_with_classdef_definitio_046.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_should_render_a_simple_class_diagram_with_markdown_styling_w_050.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_should_render_a_simple_class_diagram_with_no_attributes_only_042.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_should_render_a_simple_class_diagram_with_no_methods_only_at_043.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_should_render_a_simple_class_diagram_with_style_definition_044.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_should_render_a_simple_class_diagram_with_styles_and_the_han_052.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_should_render_classlabel_if_class_has_already_been_defined_e_038.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_elk_should_render_two_classes_with_text_labels_034.mmd`
- `fixtures/class/upstream_cypress_classdiagram_elk_v3_spec_example_001.mmd`
- `fixtures/class/upstream_cypress_classdiagram_handdrawn_v3_spec_hd_should_add_classes_namespaces_039.mmd`
- `fixtures/class/upstream_cypress_classdiagram_handdrawn_v3_spec_hd_should_render_two_classes_with_text_labels_034.mmd`
- `fixtures/class/upstream_cypress_classdiagram_spec_has_a_label_with_char_sequence_graph_023.mmd`
- `fixtures/class/upstream_cypress_classdiagram_spec_should_handle_backticks_for_namespace_and_class_names_024.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_11_should_render_a_simple_class_diagram_with_return_type_on_meth_013.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_1433_should_render_a_simple_class_with_a_title_024.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_15_should_render_a_simple_class_diagram_with_css_classes_applied_017.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_16a_should_render_a_simple_class_diagram_with_static_field_018.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_5_should_render_a_simple_class_diagram_with_abstract_method_007.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_6_should_render_a_simple_class_diagram_with_static_method_008.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_example_001.mmd`
- `fixtures/class/upstream_cypress_classdiagram_v2_spec_should_render_a_simple_class_diagram_with_style_definition_033.mmd`

## Interactivity and security-level behavior

Source files:
- `repo-ref/mermaid/packages/mermaid/src/diagrams/class/classDb.ts`

- href sanitization when `securityLevel != loose`: `fixtures/class/upstream_interactivity.mmd` and unit test `parse_diagram_class_href_sanitizes_javascript_urls_when_not_loose`
- click href target + tooltip: `fixtures/class/upstream_interactivity_click_href_target_spec.mmd`
- click call with callback args + tooltip: `fixtures/class/upstream_interactivity_click_call_with_args_spec.mmd`
- `securityLevel = loose` snapshot (callbackEffective + JS href allowed): `fixtures/class/upstream_interactivity_security_level_loose_spec.mmd`
- sandbox target coercion (`_top`): unit test `parse_diagram_class_security_level_sandbox_forces_link_target_top`
- `securityLevel = sandbox` snapshot (forces `_top`): `fixtures/class/upstream_interactivity_security_level_sandbox_target_top_spec.mmd`
- callback effective when `securityLevel = loose`: unit test `parse_diagram_class_security_level_loose_marks_callback_effective`

## Rendering-only / deferred

- `classTypes.spec.ts`, `svgDraw.spec.js`: rendering/layout-focused behavior and not part of headless parsing parity.

## Docs-derived parser+render fixture

Source: `repo-ref/mermaid/docs/syntax/classDiagram.md`

- explicit class + relationship definition (`class Animal`, `Vehicle <|-- Car`):
  `fixtures/class/upstream_docs_define_class_relationship.mmd`
- class labels:
  `fixtures/class/upstream_docs_classdiagram_class_004.mmd`
- return types in members/methods:
  `fixtures/class/upstream_docs_classdiagram_return_type_016.mmd`
- defining class members:
  `fixtures/class/upstream_docs_classdiagram_defining_members_of_a_class_012.mmd`,
  `fixtures/class/upstream_docs_classdiagram_defining_members_of_a_class_014.mmd`
- defining relationships:
  `fixtures/class/upstream_docs_classdiagram_defining_relationship_021.mmd`,
  `fixtures/class/upstream_docs_classdiagram_defining_relationship_023.mmd`
- lollipop interfaces:
  `fixtures/class/upstream_docs_classdiagram_lollipop_interfaces_033.mmd`
- namespaces:
  `fixtures/class/upstream_docs_classdiagram_define_namespace_035.mmd`
- annotations on classes:
  `fixtures/class/upstream_docs_classdiagram_annotations_on_classes_040.mmd`
- comments (`%% ...`):
  `fixtures/class/upstream_docs_classdiagram_comments_044.mmd`
- examples:
  `fixtures/class/upstream_docs_classdiagram_examples_049.mmd`,
  `fixtures/class/upstream_docs_classdiagram_examples_051.mmd`
- additional docs examples (imported 2026-02-11; parity-gated against upstream SVG baselines):
  - diagram overview:
    `fixtures/class/upstream_docs_classdiagram_class_diagrams_002.mmd`
  - class labels:
    `fixtures/class/upstream_docs_classdiagram_class_labels_008.mmd`,
    `fixtures/class/upstream_docs_classdiagram_class_labels_010.mmd`
  - relation labels:
    `fixtures/class/upstream_docs_classdiagram_labels_on_relations_026.mmd`
  - two-way relations:
    `fixtures/class/upstream_docs_classdiagram_two_way_relations_028.mmd`
  - lollipop interfaces (variant):
    `fixtures/class/upstream_docs_classdiagram_lollipop_interfaces_031.mmd`
  - cardinality / multiplicity on relations:
    `fixtures/class/upstream_docs_classdiagram_cardinality_multiplicity_on_relations_038.mmd`
  - diagram direction:
    `fixtures/class/upstream_docs_classdiagram_setting_the_direction_of_the_diagram_046.mmd`
  - examples (additional):
    `fixtures/class/upstream_docs_classdiagram_examples_053.mmd`,
    `fixtures/class/upstream_docs_classdiagram_examples_056.mmd`
  - node styling (inline styles, dasharray):
    `fixtures/class/upstream_docs_classdiagram_styling_a_node_059.mmd`
  - class blocks:
    `fixtures/class/upstream_docs_classdiagram_classes_065.mmd`,
    `fixtures/class/upstream_docs_classdiagram_classes_067.mmd`
  - default class and CSS classes:
    `fixtures/class/upstream_docs_classdiagram_default_class_070.mmd`,
    `fixtures/class/upstream_docs_classdiagram_css_classes_073.mmd`
- hide empty members box:
  `fixtures/class/upstream_docs_classdiagram_members_box_075.mmd`

## HTML demo fixtures

Source: `repo-ref/mermaid/demos/classchart.html` (via `<pre class=\"mermaid\">` blocks).

Imported (parity-gated with upstream SVG baselines):

- `fixtures/class/upstream_html_demos_classchart_class_diagram_demos_001.mmd`
- `fixtures/class/upstream_html_demos_classchart_class_diagram_demos_002.mmd`
- `fixtures/class/upstream_html_demos_classchart_class_diagram_demos_003.mmd`
- `fixtures/class/upstream_html_demos_classchart_class_diagram_demos_004.mmd`
- `fixtures/class/upstream_html_demos_classchart_class_diagram_demos_006.mmd`
- `fixtures/class/upstream_html_demos_classchart_class_diagram_demos_007.mmd`
- `fixtures/class/upstream_html_demos_classchart_class_diagram_demos_009.mmd`
- `fixtures/class/upstream_html_demos_classchart_class_diagram_demos_010.mmd`
- `fixtures/class/upstream_html_demos_classchart_class_diagram_demos_011.mmd`
- `fixtures/class/upstream_html_demos_classchart_class_diagram_demos_012.mmd`

Deferred (upstream Mermaid CLI `@11.12.2` parse error, so no SVG baseline yet):

- `repo-ref/mermaid/demos/classchart.html` block that contains the line `class People List~List~Person~~`

## Headless layout coverage (Stage A)

Layout entrypoint:

- `merman_render::layout_parsed` (diagram type `classDiagram` / `class` â†’ `LayoutDiagram::ClassDiagramV2`)

Covered by Rust tests:

- basic layout + routing: `fixtures/class/basic.mmd` via `crates/merman-render/tests/class_layout_test.rs`
- namespace clusters contain their member classes: `fixtures/class/upstream_namespaces_and_generics.mmd` via `crates/merman-render/tests/class_layout_test.rs`
- terminal label placement (cardinalities): `fixtures/class/upstream_relation_types_and_cardinalities_spec.mmd` via `crates/merman-render/tests/class_layout_test.rs`

Debug SVG exporter:

- `crates/merman-render/src/svg.rs` (`render_class_diagram_v2_debug_svg`)
- usage: `docs/rendering/CLASS_DEBUG_SVG.md`
- bulk export helper (writes to `target/debug-svgs/class/*.svg`):
  `cargo run -p xtask -- gen-debug-svgs --diagram class`

Stage-B SVG DOM comparison (against upstream baselines):

- `cargo run --release -p xtask -- compare-class-svgs --check-dom --dom-mode parity-root --dom-decimals 3`
- Exclusions (see `docs/rendering/UPSTREAM_SVG_BASELINES.md`):
  - `fixtures/class/upstream_text_label_variants_spec.mmd` (upstream CLI failure at 11.12.2)
  - `fixtures/class/upstream_parser_class_spec.mmd` (upstream prototype-key rendering artifacts)
