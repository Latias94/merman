# Block Upstream Test Coverage (Mermaid@11.12.2)

This document tracks which upstream Mermaid block parser tests are covered in `merman` via:

- snapshot fixtures under `fixtures/block/*.mmd` (goldens generated by `cargo run -p xtask -- update-snapshots`)
- layout snapshots under `fixtures/block/*.layout.golden.json` (goldens generated by `cargo run -p xtask -- update-layout-snapshots --diagram block`)
- Rust unit tests under `crates/merman-core/src/diagrams/block.rs`
- upstream SVG baselines under `fixtures/upstream-svgs/block/*.svg` (generated by `cargo run -p xtask -- gen-upstream-svgs --diagram block`)
- SVG DOM parity checks via `cargo run -p xtask -- compare-block-svgs --check-dom --dom-mode parity --dom-decimals 3`

Scope: Mermaid tag `@11.12.2`.

## `parser/block.spec.ts`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/block/parser/block.spec.ts`

### Basic nodes and labels

- a diagram with a node (`block-beta` + `id`): `fixtures/block/upstream_basic_nodes.mmd`
- a node with a square shape and a label (`id["A label"]`): `fixtures/block/upstream_basic_nodes.mmd`
- multiple nodes (`id1`, `id2`, `id3`): `fixtures/block/upstream_basic_nodes.mmd`
- adjacent statements after a shaped node (`id["A label"]` then `id2`): `fixtures/block/upstream_basic_nodes.mmd`

### Edges

- basic edge (`id1["first"] --> id2["second"]`): `fixtures/block/upstream_edges.mmd`
- labeled edge (`id1 -- "a label" --> id2`): `fixtures/block/upstream_edges.mmd`

### Columns and basic layout

- columns set to number (`columns 2`): `fixtures/block/upstream_columns_and_layout.mmd`
- missing column statements defaults to `-1`: `fixtures/block/upstream_columns_and_layout.mmd`
- `columns auto` maps to `-1`: `fixtures/block/upstream_columns_and_layout.mmd`
- blocks next to each other (`columns 2` + 2 blocks): `fixtures/block/upstream_columns_and_layout.mmd`
- blocks on top of each other (`columns 1` + 2 blocks): `fixtures/block/upstream_columns_and_layout.mmd`

### Composite blocks

- anonymous composite (`block ... end`): `fixtures/block/upstream_composites.mmd`
- nested composites: `fixtures/block/upstream_composites.mmd`
- titled composite (`block:<id>["title"] ... end`): `fixtures/block/upstream_composites.mmd`
- mixed root blocks and composites: `fixtures/block/upstream_composites.mmd`

### Arrow blocks

- single direction block arrow: `fixtures/block/upstream_block_arrows.mmd`
- multiple direction block arrow + nested block: `fixtures/block/upstream_block_arrows.mmd`

### Widths, spaces, styles, and warnings

- width-in-columns (`two["Two slots"]:2`): `fixtures/block/upstream_widths_and_spaces.mmd`
- `space` blocks: `fixtures/block/upstream_widths_and_spaces.mmd`
- `classDef` + `class` application: `fixtures/block/upstream_styles.mmd`
- `style` statement applied to a block: `fixtures/block/upstream_styles.mmd`
- warning when block width exceeds configured columns: `fixtures/block/upstream_warnings.mmd`

### Prototype properties

- `__proto__` and `constructor` ids should not throw: `fixtures/block/upstream_prototype_properties.mmd`

## Notes on Parity

- Mermaid block diagrams generate ids with a random prefix plus an incrementing counter. Our snapshot and DOM-parity tooling normalizes only the random prefix and preserves the counter (`id-<id>-<n>`).
- Mermaid does not emit `id="..."` on the node `<g>` for the special ids `id`, `__proto__`, and `constructor`; DOM-parity tests cover this behavior via `fixtures/block/upstream_prototype_properties.mmd`.
