# C4 Upstream Test Coverage (Mermaid@11.12.2)

This document tracks which upstream Mermaid C4 parser tests are covered in `merman` via:

- snapshot fixtures under `fixtures/c4/*.mmd` (goldens generated by `cargo run -p xtask -- update-snapshots`)
- Rust unit tests under `crates/merman-core/src/diagrams/c4.rs`

Scope: Mermaid tag `@11.12.2`.

## `parser/c4Diagram.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/c4/parser/c4Diagram.spec.js`

- trailing whitespace after statements: unit test `c4_trailing_whitespace_after_statements_is_accepted` in `crates/merman-core/src/diagrams/c4.rs`
- parameter names that are keywords: `fixtures/c4/upstream_c4Diagram_spec.mmd`
- allow `default` in parameters: `fixtures/c4/upstream_c4Diagram_spec.mmd`

## `parser/c4Person.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/c4/parser/c4Person.spec.js`

- parse one `Person(...)`: `fixtures/c4/upstream_person_spec.mmd`
- alias / label / description: `fixtures/c4/upstream_person_spec.mmd`
- sprite / link / tags via kv-objects in the label slot: `fixtures/c4/upstream_person_spec.mmd`

## `parser/c4PersonExt.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/c4/parser/c4PersonExt.spec.js`

- parse one `Person_Ext(...)`: `fixtures/c4/upstream_person_ext_spec.mmd`
- alias / label / description: `fixtures/c4/upstream_person_ext_spec.mmd`
- sprite / link / tags via kv-objects in the label slot: `fixtures/c4/upstream_person_ext_spec.mmd`

## `parser/c4System.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/c4/parser/c4System.spec.js`

- system macros and `typeC4Shape` mapping:
  - `System`, `SystemDb`, `SystemQueue`
  - `System_Ext`, `SystemDb_Ext`, `SystemQueue_Ext`
  - `fixtures/c4/upstream_system_spec.mmd`
- alias / label / description: `fixtures/c4/upstream_system_spec.mmd`
- sprite / link / tags via kv-objects in the label slot: `fixtures/c4/upstream_system_spec.mmd`

## `parser/c4Container.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/c4/parser/c4Container.spec.js`

- container macros and `typeC4Shape` mapping:
  - `Container`, `ContainerDb`, `ContainerQueue`
  - `Container_Ext`, `ContainerDb_Ext`, `ContainerQueue_Ext`
  - `fixtures/c4/upstream_container_spec.mmd`
- alias / label / technology / description: `fixtures/c4/upstream_container_spec.mmd`
- sprite / link / tags via kv-objects in the label slot: `fixtures/c4/upstream_container_spec.mmd`

## `parser/c4Boundary.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/c4/parser/c4Boundary.spec.js`

- parse `Boundary(...) { ... }` and nested parent boundary assignment: `fixtures/c4/upstream_boundary_spec.mmd`
- alias / label / type: `fixtures/c4/upstream_boundary_spec.mmd`
- link / tags via kv-objects in the label slot: `fixtures/c4/upstream_boundary_spec.mmd`

## Additional grammar coverage (`parser/c4Diagram.jison`)

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/c4/parser/c4Diagram.jison`

- headers beyond `C4Context`:
  - `C4Container` + `direction LR`: `fixtures/c4/upstream_c4container_header_and_direction_spec.mmd`
  - `C4Component`: `fixtures/c4/upstream_c4component_header_spec.mmd`
  - `C4Dynamic` + `RelIndex(...)`: `fixtures/c4/upstream_c4dynamic_header_and_relindex_spec.mmd`
- component macros: `fixtures/c4/upstream_c4component_header_spec.mmd`
- relationship direction macros (`Rel_Up/Down/Left/Right/Back`): `fixtures/c4/upstream_rel_direction_macros_spec.mmd`
- deployment node variants (`Node_L`, `Node_R`, `Deployment_Node`): `fixtures/c4/upstream_deployment_node_lr_spec.mmd`
- boundary type injection (`Enterprise_Boundary`, `System_Boundary`, `Container_Boundary`): `fixtures/c4/upstream_boundary_type_injection_spec.mmd`
- `UpdateElementStyle` supports more fields: `fixtures/c4/upstream_update_element_style_all_fields_spec.mmd`
- `UpdateLayoutConfig` ignores invalid values: `fixtures/c4/upstream_update_layout_config_invalid_values_spec.mmd`
