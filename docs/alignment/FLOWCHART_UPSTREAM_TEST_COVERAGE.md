# Flowchart Upstream Test Coverage (Mermaid@11.12.2)

This document tracks which upstream Mermaid flowchart tests are covered in `merman` via:

- snapshot fixtures under `fixtures/flowchart/*.mmd` (goldens generated by `cargo run -p xtask -- update-snapshots`)
- Rust unit tests under `crates/merman-core/src/lib.rs`
- upstream SVG baselines under `fixtures/upstream-svgs/flowchart/*.svg` (generated by `cargo run -p xtask -- gen-upstream-svgs --diagram flowchart`)
- SVG DOM compare via `cargo run --release -p xtask -- compare-flowchart-svgs --check-dom --dom-mode parity-root --dom-decimals 3`

Scope: Mermaid tag `@11.12.2`.

## External regression cases

These fixtures are sourced from downstream renderer reports (outside Mermaid's own test suite) and
are parity-gated against upstream SVG baselines:

- Text/`<foreignObject>` label rendering: `fixtures/flowchart/mmdr_issue_28_text_rendering.mmd`
- Long edge labels + pipe notation spacing: `fixtures/flowchart/mmdr_issue_29_edge_label_distance.mmd`
- mmdr test fixture (complex subgraph layout): `fixtures/flowchart/mmdr_tests_flowchart_flowchart_complex.mmd`
- mmdr test fixture (ports): `fixtures/flowchart/mmdr_tests_flowchart_flowchart_ports.mmd`
- mmdr test fixture (styles): `fixtures/flowchart/mmdr_tests_flowchart_flowchart_styles.mmd`
- mmdr test fixture (edges): `fixtures/flowchart/mmdr_tests_flowchart_flowchart_edges.mmd`
- mmdr test fixture (cycles): `fixtures/flowchart/mmdr_tests_flowchart_flowchart_cycles.mmd`
- mmdr test fixture (dense): `fixtures/flowchart/mmdr_tests_flowchart_flowchart_dense.mmd`
- mmdr test fixture (subgraphs): `fixtures/flowchart/mmdr_tests_flowchart_flowchart_subgraph.mmd`
- mmdr test fixture (subgraph direction): `fixtures/flowchart/mmdr_tests_flowchart_flowchart_subgraph_direction.mmd`

Reference: `docs/alignment/EXTERNAL_FIXTURES.md`.

## Cypress rendering specs

Source: `repo-ref/mermaid/cypress/integration/rendering/*flowchart*.spec.*`

These fixtures are imported from Mermaid's Cypress rendering tests and are parity-gated against
upstream SVG baselines (rendered via `mmdc` with our pinned CLI config):

- `fixtures/flowchart/upstream_cypress_appli_spec_should_render_subgraphs_with_title_margins_and_edge_labels_002.mmd`
- `fixtures/flowchart/upstream_cypress_conf_and_directives_spec_settings_from_initialize_overriding_themevariable_nodes_should_b_003.mmd`
- `fixtures/flowchart/upstream_cypress_conf_and_directives_spec_settings_from_directive_nodes_should_be_grey_004.mmd`
- `fixtures/flowchart/upstream_cypress_conf_and_directives_spec_settings_from_frontmatter_nodes_should_be_grey_005.mmd`
- `fixtures/flowchart/upstream_cypress_conf_and_directives_spec_example_001.mmd`
- `fixtures/flowchart/upstream_cypress_conf_and_directives_spec_settings_from_initialize_nodes_should_be_green_002.mmd`
- `fixtures/flowchart/upstream_cypress_conf_and_directives_spec_settings_from_directive_overriding_theme_variable_nodes_should_b_006.mmd`
- `fixtures/flowchart/upstream_cypress_conf_and_directives_spec_settings_from_initialize_and_directive_nodes_should_be_grey_007.mmd`
- `fixtures/flowchart/upstream_cypress_conf_and_directives_spec_theme_from_initialize_directive_overriding_theme_variable_nodes_008.mmd`
- `fixtures/flowchart/upstream_cypress_conf_and_directives_spec_theme_from_initialize_frontmatter_overriding_theme_variable_node_009.mmd`
- `fixtures/flowchart/upstream_cypress_conf_and_directives_spec_theme_from_initialize_frontmatter_overriding_theme_variable_dire_010.mmd`
- `fixtures/flowchart/upstream_cypress_conf_and_directives_spec_should_render_if_values_are_not_quoted_properly_011.mmd`
- `fixtures/flowchart/upstream_cypress_conf_and_directives_spec_theme_variable_from_initialize_theme_from_directive_nodes_should_012.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_example_001.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fdh21_render_cylindrical_shape_021.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fdh22_render_a_simple_flowchart_with_nodespacing_set_to_100_022.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fdh24_keep_node_label_text_if_already_defined_when_a_style_is_ap_024.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fdh30_possibility_to_style_text_color_of_nodes_and_subgraphs_as_030.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fdh41_handle_styling_for_all_node_shapes_039.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fdh43_fontawesome_icons_in_edge_labels_041.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fdh44_fontawesome_icons_in_edge_labels_042.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fhd12_should_render_a_flowchart_with_long_names_and_class_defini_012.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fhd9_should_render_subgraphs_009.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fhd10_should_render_subgraphs_with_a_title_starting_with_a_digit_010.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fhd13_should_render_color_of_styled_nodes_013.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fhd20_multiple_nodes_and_chaining_in_one_statement_020.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fhd14_should_render_hexagons_014.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fhd16_render_stadium_shape_016.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fhd17_render_multiline_texts_017.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fhd3_should_render_a_simple_flowchart_with_line_breaks_003.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fhd4_should_render_a_simple_flowchart_with_trapezoid_and_inverse_004.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fhd6_should_render_a_flowchart_full_of_circles_006.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fhd7_should_render_a_flowchart_full_of_icons_007.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fhd5_should_style_nodes_via_a_class_005.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_2_should_render_a_simple_flowchart_with_diagrampadding_set_to_0_002.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_3_a_link_with_correct_arrowhead_to_a_subgraph_003.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_53_handle_nested_subgraphs_with_edges_in_and_out_011.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_59_handle_styling_of_subgraphs_and_links_019.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_60_handle_styling_for_all_node_shapes_v2_020.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_62_should_render_styled_subgraphs_022.mmd`
- `fixtures/flowchart/upstream_cypress_theme_spec_should_render_a_flowchart_diagram_004.mmd`
- `fixtures/flowchart/upstream_cypress_theme_spec_example_001.mmd`
- `fixtures/flowchart/upstream_cypress_theme_spec_should_not_allow_unbalanced_css_definitions_2_002.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fdh25_handle_link_click_events_link_anchor_mailto_other_protocol_025.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fdh26_set_text_color_of_nodes_and_links_according_to_styles_when_026.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fdh28_apply_default_class_to_all_nodes_which_do_not_have_another_028.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fdh32_render_subroutine_shape_032.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fdh35_should_honor_minimum_edge_length_as_specified_by_the_user_035.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fdh45_fontawesome_icons_in_edge_labels_043.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_handdrawn_spec_fdh48_should_be_able_to_style_default_node_independently_046.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_spec_68_should_honor_subgraph_direction_when_inheritdir_is_false_048.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_spec_69_should_inherit_global_direction_when_inheritdir_is_true_049.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_spec_6369_edge_color_should_affect_arrow_head_047.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_2050_handling_of_different_rendering_direction_in_subgraphs_037.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_4_length_of_edges_004.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_50_handle_nested_subgraphs_in_reverse_order_008.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_52_handle_nested_subgraphs_in_several_levels_010.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_55_handle_nested_subgraphs_with_outgoing_links_2_013.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_54_handle_nested_subgraphs_with_outgoing_links_012.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_56_handle_nested_subgraphs_with_outgoing_links_3_014.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_57_handle_nested_subgraphs_with_outgoing_links_2_016.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_57_x_handle_nested_subgraphs_with_outgoing_links_5_017.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_57_handle_nested_subgraphs_with_outgoing_links_4_015.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_should_render_self_loops_063.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_should_not_auto_wrap_when_markdownautowrap_is_false_058.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_should_render_subgraphs_with_title_margins_set_lr_059.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_should_render_subgraphs_with_title_margins_set_td_060.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_wrapping_long_text_with_a_new_line_051.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_sub_graphs_and_markdown_strings_052.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_wrapping_long_text_with_a_new_line_056.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_sub_graphs_and_markdown_strings_057.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_v2_16_render_stadium_shape_007.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_63_title_on_subgraphs_should_be_themeable_023.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_5059_should_render_when_subgraph_contains_only_subgraphs_has_lin_045.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_4023_should_render_html_labels_with_images_and_or_text_correctly_042.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_5064_should_render_when_subgraph_child_has_links_to_outside_node_044.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_with_styling_and_classes_048.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_with_formatting_in_a_node_049.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_with_styling_and_classes_053.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_with_formatting_in_a_node_054.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_new_line_in_node_and_formatted_edge_label_050.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_new_line_in_node_and_formatted_edge_label_055.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_should_render_raw_strings_072.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_65_3_bigger_font_from_classes_026.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_should_be_possible_to_use_syntax_to_add_labels_with_trail_spaces_066.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_66_more_nested_subgraph_cases_tb_027.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_67_more_nested_subgraph_cases_rl_028.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_68_more_nested_subgraph_cases_bt_029.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_69_more_nested_subgraph_cases_lr_030.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_70_handle_nested_subgraph_cases_tb_link_out_and_link_between_sub_031.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_71_handle_nested_subgraph_cases_rl_link_out_and_link_between_sub_032.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_72_handle_nested_subgraph_cases_bt_link_out_and_link_between_sub_033.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_74_handle_labels_for_multiple_edges_from_and_to_the_same_couple_035.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_should_render_a_rounded_rectangle_and_a_normal_rectangle_070.mmd`
- `fixtures/flowchart/upstream_cypress_flowchart_v2_spec_6617_per_link_curve_styling_using_edge_ids_071.mmd`

Deferred (not parity-gated yet):

- `layout: elk` fixtures (requires ELK layout parity support): `fixtures/_deferred/flowchart/upstream_cypress_flowchart_elk_spec_*.mmd`

## Docs-derived parser+render fixtures

Source: `repo-ref/mermaid/docs/syntax/flowchart.md`

These fixtures are imported from Mermaid's public syntax docs (code blocks) and stored as:

- `fixtures/flowchart/upstream_docs_flowchart_*.mmd`

The batch currently includes examples for:

- new shapes: `fixtures/flowchart/upstream_docs_flowchart_example_flowchart_with_new_shapes_041.mmd`
- additional shape nodes (hexagon/parallelogram/trapezoid/double-circle):
  - `fixtures/flowchart/upstream_docs_flowchart_a_hexagon_node_027.mmd`
  - `fixtures/flowchart/upstream_docs_flowchart_parallelogram_029.mmd`
  - `fixtures/flowchart/upstream_docs_flowchart_parallelogram_alt_031.mmd`
  - `fixtures/flowchart/upstream_docs_flowchart_trapezoid_033.mmd`
  - `fixtures/flowchart/upstream_docs_flowchart_trapezoid_alt_035.mmd`
  - `fixtures/flowchart/upstream_docs_flowchart_double_circle_037.mmd`
- image nodes (`@{ img: ... }` parameters): `fixtures/flowchart/upstream_docs_flowchart_parameters_136.mmd`
- `@{ shape: ... }` parameter nodes (`rect`, `rounded`, `stadium`, `subproc`):
  - `fixtures/flowchart/upstream_docs_flowchart_process_042.mmd`
  - `fixtures/flowchart/upstream_docs_flowchart_event_044.mmd`
  - `fixtures/flowchart/upstream_docs_flowchart_terminal_point_stadium_046.mmd`
  - `fixtures/flowchart/upstream_docs_flowchart_subprocess_048.mmd`
- edge animations (`animate` / `animation: fast|slow`): `fixtures/flowchart/upstream_docs_flowchart_turning_an_animation_on_170.mmd`,
  `fixtures/flowchart/upstream_docs_flowchart_selecting_type_of_animation_172.mmd`,
  `fixtures/flowchart/upstream_docs_flowchart_using_classdef_statements_for_animations_174.mmd`
- multi-directional arrows (circle/cross/double-ended): `fixtures/flowchart/upstream_docs_flowchart_multi_directional_arrows_180.mmd`
- edge-curve style overrides via edge ids: `fixtures/flowchart/upstream_docs_flowchart_edge_level_curve_style_using_edge_ids_v11_10_0_216.mmd`

## Parser specs

### `parser/flow-comments.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-comments.spec.js`

- comments at start/middle/end + no trailing newline: `fixtures/flowchart/upstream_comments.mmd`
- comment containing mermaid-like tokens must not affect parsing: `fixtures/flowchart/upstream_comments.mmd`

### `parser/flow-arrows.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-arrows.spec.js`

- header direction shorthand (`graph >`, `<`, `^`, `v`): unit test `parse_diagram_flowchart_header_direction_shorthand` in `crates/merman-core/src/lib.rs`
- spaces around arrows + statements without trailing semicolons: unit tests like `parse_diagram_flowchart_basic_graph` and arrow-related tests
- multi-directional arrows (double-ended, thick, dotted): unit tests like `parse_diagram_flowchart_double_ended_arrows` and `parse_diagram_flowchart_edge_stroke_and_type_normal_thick_dotted`

### `parser/flow-edges.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-edges.spec.js`

- open/cross/circle-ended edges + pipe labels: `fixtures/flowchart/upstream_edges.mmd`
- edge ids + label handling + length matrix + keyword edge labels: unit tests:
  - `parse_diagram_flowchart_edges_spec_open_cross_circle`
  - `parse_diagram_flowchart_edges_spec_edge_ids_and_node_metadata_do_not_conflict`
  - `parse_diagram_flowchart_edges_spec_edge_length_matrix`
  - `parse_diagram_flowchart_edges_spec_keywords_as_edge_labels_in_double_ended_edges`

### `parser/flow-direction.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-direction.spec.js`

- subgraph direction statements (`direction BT|RL|LR` etc) and “last wins”: unit test `parse_diagram_flowchart_subgraph_direction_statement_sets_dir` in `crates/merman-core/src/lib.rs`
- nested subgraphs direction + membership rules: unit tests:
  - `parse_diagram_flowchart_supports_nested_subgraphs`
  - `parse_diagram_flowchart_subgraph_chain_membership_order_matches_mermaid`
- snapshot coverage of representative subgraph direction + nesting: `fixtures/flowchart/upstream_subgraphs.mmd`

### `parser/flow-md-string.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-md-string.spec.js`

- markdown strings in node + edge labels: `fixtures/flowchart/upstream_markdown_strings.mmd`
- markdown strings in subgraph titles: `fixtures/flowchart/upstream_markdown_subgraphs.mmd`

### `parser/flow-node-data.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-node-data.spec.js`

- shapeData statements (`@{...}`) basic + multiline label rewriting: `fixtures/flowchart/upstream_node_data_minimal.mmd`
- shapeData shape alias acceptance (no underscores; includes hyphenated aliases like `lean-right`, `inv-trapezoid`): `fixtures/flowchart/upstream_flow_node_data_shape_aliases_spec.mmd`
- shapeData multiline strings + special characters (`}` / `@`) in labels: `fixtures/flowchart/upstream_flow_node_data_multiline_strings_spec.mmd`
- broader matrix + validation errors + edge-id metadata: unit tests:
  - `parse_diagram_flowchart_node_data_*`
  - `parse_diagram_flowchart_edge_curve_properties_using_edge_id`

### `parser/flow-style.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-style.spec.js`

- `style` statements (single/multiple/mixed with edges): `fixtures/flowchart/upstream_flow_style_style_stmt_spec.mmd`
- node label preservation when applying `style` to existing and new nodes: `fixtures/flowchart/upstream_flow_style_style_preserves_labels_spec.mmd`
- `style` expressions (SVG output / multiple style keys): `fixtures/flowchart/upstream_flowchart_v2_style_expressions_spec.mmd`
- `classDef` edge cases (dots, spaces, percentages) + `class` assignment lists/underscores: `fixtures/flowchart/upstream_flow_style_classdef_edgecases_spec.mmd`
- inline `:::Class` variants (standalone, edge statements, punctuation): `fixtures/flowchart/upstream_flow_style_inline_class_variants_spec.mmd`
- group behavior for `:::Class` + multiple classes/styles: unit tests:
  - `parse_diagram_flowchart_classdef_and_class_assign_work`
  - `parse_diagram_flowchart_inline_vertex_class_via_style_separator`
  - `parse_diagram_flowchart_inline_vertex_class_in_groups_matches_mermaid_style_spec`
  - `parse_diagram_flowchart_style_statement_supports_multiple_styles`
  - `parse_diagram_flowchart_classdef_supports_multiple_classes`
- `classDef` supports multiple class names: `fixtures/flowchart/upstream_flowdb_addclass_spec.mmd`

### `parser/flow-interactions.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-interactions.spec.js`

- click link syntax matrix (`"url"` vs `href`, tooltip, target): `fixtures/flowchart/upstream_flow_interactions_links_spec.mmd`
- click callback syntax matrix (`callback` vs `call callback()`, tooltip, args) under `securityLevel: strict`: `fixtures/flowchart/upstream_flow_interactions_callbacks_strict_spec.mmd`
- callback gating under `securityLevel: loose` (`haveCallback`): `fixtures/flowchart/upstream_flow_interactions_callbacks_loose_spec.mmd`
- click href + tooltip + linkTarget (with subgraphs): `fixtures/flowchart/subgraph_click.mmd`
- `javascript:` URL sanitization when `securityLevel != loose`: `fixtures/flowchart/upstream_linkstyle_and_click.mmd`
- callback parsing + `securityLevel` gating: unit tests:
  - `parse_diagram_flowchart_click_link_sets_link_and_tooltip_and_clickable_class`
  - `parse_diagram_flowchart_click_link_sanitizes_javascript_urls_when_not_loose`

### `parser/flow-lines.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-lines.spec.js`

- `linkStyle` interpolate (default): `fixtures/flowchart/upstream_flowchart_v2_lines_linkstyle_default_interpolate_basis_spec.mmd`
- `linkStyle` interpolate (numbered): `fixtures/flowchart/upstream_flowchart_v2_lines_linkstyle_numbered_interpolate_spec.mmd`
- `linkStyle` interpolate (multi-numbered): `fixtures/flowchart/upstream_flowchart_v2_lines_linkstyle_multi_numbered_interpolate_spec.mmd`
- `linkStyle` interpolate with style (`stroke-width:1px;`):
  - `fixtures/flowchart/upstream_flowchart_v2_lines_linkstyle_default_interpolate_basis_with_style_spec.mmd`
  - `fixtures/flowchart/upstream_flowchart_v2_lines_linkstyle_numbered_interpolate_with_style_spec.mmd`
  - `fixtures/flowchart/upstream_flowchart_v2_lines_linkstyle_multi_numbered_interpolate_basis_with_style_spec.mmd`
- edge curve properties via edge id (`e1@{curve: ...}`): `fixtures/flowchart/upstream_flowchart_v2_lines_edge_id_curve_properties_spec.mmd`
- edge curve properties via edge id without overriding default: `fixtures/flowchart/upstream_flowchart_v2_lines_edge_id_curve_without_overriding_default_spec.mmd`
- edge curve properties via edge id mixed with `linkStyle`: `fixtures/flowchart/upstream_flowchart_v2_lines_edge_id_curve_mixed_with_linkstyle_spec.mmd`
- line stroke notation (`-.->`, `==>`): `fixtures/flowchart/upstream_flowchart_v2_lines_stroke_dotted_spec.mmd` and `fixtures/flowchart/upstream_flowchart_v2_lines_stroke_thick_spec.mmd`
- combined compatibility fixture (also covers click parsing and sanitization): `fixtures/flowchart/upstream_linkstyle_and_click.mmd`
- compatibility edge-curve fixture (pre v2 naming): `fixtures/flowchart/upstream_lines_edge_curve_properties_spec.mmd`

### `parser/flow-text.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-text.spec.js`

- edge label parsing variants (pipe notation, new notation, quoted labels): `fixtures/flowchart/upstream_text_edge_labels_spec.mmd`
- multi-line edge label parsing across line breaks (circle/point arrows): `fixtures/flowchart/upstream_flow_text_multiline_edge_labels_spec.mmd`
- special characters in vertex text and ids (slashes/backslashes, unicode, trailing `-` ids): `fixtures/flowchart/upstream_flow_text_special_chars_spec.mmd`
- edge + line label matrix (pipe labels, "new notation", line strokes with labels): `fixtures/flowchart/upstream_flow_text_edge_and_line_text_variants_spec.mmd`
- vertex text variants (spaces/underscores/quoted, circle, URL-like text, punctuation, backslashes): `fixtures/flowchart/upstream_flow_text_vertex_text_variants_spec.mmd`
- `v` in node ids edge cases (`A--xv(my text)` etc): `fixtures/flowchart/upstream_flow_text_v_in_node_ids_variants_spec.mmd` and unit test `parse_diagram_flowchart_v_in_node_ids_variants_from_flow_text_spec` in `crates/merman-core/src/lib.rs`
- parser error cases (invalid/nested quotes, unterminated labels, invalid structural chars): unit test `parse_diagram_flowchart_flow_text_error_cases_from_upstream_spec` in `crates/merman-core/src/lib.rs`
- ellipse vertex is covered as parser-only due to upstream rendering bug (Mermaid issue `#5976`): `fixtures/flowchart/upstream_flow_text_ellipse_vertex_parser_only_spec.mmd`

### `parser/flow-singlenode.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-singlenode.spec.js`

- single node parsing + shape variants + numeric ids in subgraphs: `fixtures/flowchart/upstream_singlenode_shapes_spec.mmd`

### `parser/flow-vertice-chaining.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-vertice-chaining.spec.js`

- chained vertices and multi-vertex statements (`A-->B-->C`, `A & B --> C`, etc):
  - combined fixture: `fixtures/flowchart/upstream_vertice_chaining_spec.mmd`
  - split fixtures:
    - `fixtures/flowchart/upstream_flow_vertice_chaining_simple_spec.mmd`
    - `fixtures/flowchart/upstream_flow_vertice_chaining_amp_to_single_spec.mmd`
    - `fixtures/flowchart/upstream_flow_vertice_chaining_single_to_amp_spec.mmd`
    - `fixtures/flowchart/upstream_flow_vertice_chaining_both_ends_amp_spec.mmd`
    - `fixtures/flowchart/upstream_flow_vertice_chaining_fvc_spec.mmd`
    - `fixtures/flowchart/upstream_flow_vertice_chaining_with_extras_spec.mmd`
- group edge-id behavior for multi-vertex statements: unit tests:
  - `parse_diagram_flowchart_node_data_unique_edge_ids_with_groups`
  - `parse_diagram_flowchart_node_data_redefined_edge_id_becomes_auto_id`

### `parser/flow.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow.spec.js`

- keyword substrings in node ids + trailing whitespace: `fixtures/flowchart/upstream_flow_spec_special_chars_and_a11y.mmd`
- special characters in node labels (`<` -> `&lt;` etc): `fixtures/flowchart/upstream_flow_spec_special_chars_and_a11y.mmd`
- `accTitle` / multiline `accDescr { ... }`: `fixtures/flowchart/upstream_flow_spec_special_chars_and_a11y.mmd`

### `parser/subgraph.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/subgraph.spec.js`

- subgraph syntaxes (title-only, explicit id + title, quoted titles, numeric ids): unit tests:
  - `parse_diagram_flowchart_supports_subgraph_block`
  - `parse_diagram_flowchart_subgraph_supports_explicit_id_and_title`
  - `parse_diagram_flowchart_subgraph_title_with_spaces_uses_auto_id`
  - `parse_diagram_flowchart_subgraph_title_with_spaces_in_quotes_uses_auto_id`
  - `parse_diagram_flowchart_subgraph_id_and_title_notation`
  - `parse_diagram_flowchart_subgraph_tab_indentation_matches_mermaid_membership_order`
- snapshot coverage of representative variants + nesting: `fixtures/flowchart/upstream_subgraphs.mmd`
- snapshot coverage of additional subgraph syntax variants (old-style titles, dashed ids, bracket title forms, per-subgraph direction): `fixtures/flowchart/upstream_subgraph_syntax_matrix_spec.mmd`

## DB / renderer specs

### `flowDb.spec.ts`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/flowDb.spec.ts`

- `linkStyle` interpolate (`default` and numbered): `fixtures/flowchart/upstream_linkstyle_and_click.mmd` and unit tests:
  - `parse_diagram_flowchart_linkstyle_default_interpolate_sets_edge_defaults`
  - `parse_diagram_flowchart_linkstyle_numbered_interpolate_sets_edges`
  - `parse_diagram_flowchart_linkstyle_multi_numbered_interpolate_sets_edges`
- subgraph membership ordering parity (FlowDB semantics): unit tests under `parse_diagram_flowchart_subgraph_*`
- subgraph membership uniqueness (`makeUniq`): `fixtures/flowchart/upstream_flowdb_makeuniq_spec.mmd`
- subgraph membership helper (`exists`): unit test in `crates/merman-core/src/diagrams/flowchart.rs` (`flowchart_subgraphs_exist_matches_mermaid_flowdb_spec`)
- `addClass` supports comma-separated class names: `fixtures/flowchart/upstream_flowdb_addclass_spec.mmd`

### `flowChartShapes.spec.js` (rendering)

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/flowChartShapes.spec.js`

- upstream unit tests validate low-level SVG shape geometry and translation.
- in `merman`, we validate the same shapes end-to-end via SVG DOM parity fixtures instead of porting the JS unit test harness:
  - shape aliases via `@{ shape: ... }`: `fixtures/flowchart/upstream_flow_node_data_shape_aliases_spec.mmd`
  - flowchart syntax shape matrix: `fixtures/flowchart/upstream_flowchart_v2_shape_styling_matrix_spec.mmd`

### `cypress/integration/rendering/flowchart-v2.spec.js` (rendering)

Source: `repo-ref/mermaid/cypress/integration/rendering/flowchart-v2.spec.js`

- simple flowchart smoke: `fixtures/flowchart/upstream_flowchart_v2_simple_flowchart_spec.mmd`
- `diagramPadding: 0`: `fixtures/flowchart/upstream_flowchart_v2_diagramPadding_0_spec.mmd`
- `useMaxWidth: true`: `fixtures/flowchart/upstream_flowchart_v2_useMaxWidth_true_spec.mmd`
- `useMaxWidth: false`: `fixtures/flowchart/upstream_flowchart_v2_useMaxWidth_false_spec.mmd`
- escaped HTML in labels when `htmlLabels: false`: `fixtures/flowchart/upstream_flowchart_v2_escaped_without_html_labels_spec.mmd`
- unescaped HTML in labels when `htmlLabels: true` + `securityLevel: loose`: `fixtures/flowchart/upstream_flowchart_v2_unescaped_with_html_labels_spec.mmd`
- stadium shape (V2-16): `fixtures/flowchart/upstream_flowchart_v2_stadium_shape_spec.mmd`
- edge to subgraph/cluster arrowhead clipping: `fixtures/flowchart/upstream_flowchart_v2_link_to_subgraph_arrowhead_spec.mmd`
- edge length matrix rendering: `fixtures/flowchart/upstream_flowchart_v2_edge_lengths_spec.mmd`
- nested subgraphs (reverse order): `fixtures/flowchart/upstream_flowchart_v2_nested_subgraphs_reverse_order_spec.mmd`
- nested subgraphs (several levels): `fixtures/flowchart/upstream_flowchart_v2_nested_subgraphs_several_levels_spec.mmd`
- nested subgraphs (edges in/out): `fixtures/flowchart/upstream_flowchart_v2_edges_in_and_out_subgraphs_spec.mmd`
- nested subgraphs (mixed directions): `fixtures/flowchart/upstream_flowchart_v2_subgraphs_different_directions_spec.mmd`
- nested subgraphs (outgoing links): `fixtures/flowchart/upstream_flowchart_v2_outgoing_links_spec.mmd`
- nested subgraphs (outgoing links 2): `fixtures/flowchart/upstream_flowchart_v2_outgoing_links_2_spec.mmd`
- nested subgraphs (outgoing links 2b): `fixtures/flowchart/upstream_flowchart_v2_outgoing_links_2b_spec.mmd`
- nested subgraphs (outgoing links 3): `fixtures/flowchart/upstream_flowchart_v2_outgoing_links_3_spec.mmd`
- nested subgraphs (outgoing links 4): `fixtures/flowchart/upstream_flowchart_v2_outgoing_links_4_spec.mmd`
- nested subgraphs (outgoing links 5): `fixtures/flowchart/upstream_flowchart_v2_outgoing_links_5_spec.mmd`
- styling with style expressions: `fixtures/flowchart/upstream_flowchart_v2_style_expressions_spec.mmd`
- styling of subgraphs and links: `fixtures/flowchart/upstream_flowchart_v2_subgraphs_and_link_styles_spec.mmd`
- styling matrix for all shapes: `fixtures/flowchart/upstream_flowchart_v2_shape_styling_matrix_spec.mmd`
- icons in edge labels: `fixtures/flowchart/upstream_flowchart_v2_icons_in_edge_labels_spec.mmd`
- YAML config for spacing in subgraphs: `fixtures/flowchart/upstream_flowchart_v2_subgraph_nodeSpacing_rankSpacing_yaml_spec.mmd`
- styled subgraphs: `fixtures/flowchart/upstream_flowchart_v2_styled_subgraphs_spec.mmd`
- subgraph title theme variables: `fixtures/flowchart/upstream_flowchart_v2_subgraph_title_themeable_spec.mmd`
- class-based text color: `fixtures/flowchart/upstream_flowchart_v2_text_color_from_classes_spec.mmd`
- class-based bold labels: `fixtures/flowchart/upstream_flowchart_v2_bold_text_from_classes_spec.mmd`
- class-based large font labels: `fixtures/flowchart/upstream_flowchart_v2_bigger_font_from_classes_spec.mmd`
- more nested subgraph cases (TB/RL/BT/LR): `fixtures/flowchart/upstream_flowchart_v2_more_nested_subgraph_cases_tb_spec.mmd` (and `*_rl_spec`, `*_bt_spec`, `*_lr_spec`)
- nested subgraph links out/between (TB/RL/BT): `fixtures/flowchart/upstream_flowchart_v2_nested_subgraph_link_out_and_between_tb_spec.mmd` (and `*_rl_spec`, `*_bt_spec`)
- `default` in node name: `fixtures/flowchart/upstream_flowchart_v2_default_in_node_name_spec.mmd`
- subgraph title margins (LR, `htmlLabels: false`): `fixtures/flowchart/upstream_flowchart_v2_subgraph_title_margins_lr_htmlLabels_false_spec.mmd`
- subgraph title margins (edge labels): `fixtures/flowchart/upstream_flowchart_v2_subgraph_title_margins_with_edge_labels_spec.mmd`
- self loops (including nested subgraphs): `fixtures/flowchart/upstream_flowchart_v2_self_loops_spec.mmd`
- clipping of edges (flowchart-v2.spec.js#2824): `fixtures/flowchart/upstream_flowchart_v2_clipping_of_edges_spec.mmd`
- multiple labeled edges between same nodes: `fixtures/flowchart/upstream_flowchart_v2_multiple_labeled_edges_between_same_nodes_spec.mmd`
- HTML labels with images and/or text (flowchart-v2.spec.js#4023): `fixtures/flowchart/upstream_flowchart_v2_html_labels_with_images_and_text_spec.mmd`
- missing images should not crash: `fixtures/flowchart/upstream_flowchart_v2_missing_images_should_not_crash_spec.mmd`
- unicode-encoded characters in HTML labels (`htmlLabels: true`): `fixtures/flowchart/upstream_flowchart_v2_unicode_encoded_character_html_labels_true_spec.mmd`
- titled flowchart (`titleTopMargin: 10`): `fixtures/flowchart/upstream_flowchart_v2_titled_flowchart_titleTopMargin_10_spec.mmd`
- invisible edges (`titleTopMargin: 10`): `fixtures/flowchart/upstream_flowchart_v2_invisible_edges_titleTopMargin_10_spec.mmd`
- subgraph child links to outside node + subgraph (flowchart-v2.spec.js#5064): `fixtures/flowchart/upstream_flowchart_v2_subgraph_child_links_outside_spec.mmd`
- subgraph contains only subgraphs, links outside (flowchart-v2.spec.js#5059): `fixtures/flowchart/upstream_flowchart_v2_subgraph_only_subgraphs_links_outside_spec.mmd`
- nodeSpacing/rankSpacing (main graph override): `fixtures/flowchart/upstream_flowchart_v2_subgraph_nodeSpacing_rankSpacing_main_graph_spec.mmd`
- nodeSpacing/rankSpacing (large config): `fixtures/flowchart/upstream_flowchart_v2_subgraph_nodeSpacing_rankSpacing_large_spec.mmd`

## Additional parity fixtures (non-upstream)

These fixtures do not correspond 1:1 to a specific upstream `*.spec.*` test, but they capture
observed upstream SVG behaviors that are easy to regress when refactoring layout/rendering:

- cross-subgraph labeled edges: `fixtures/flowchart/upstream_flowchart_v2_stage2_cross_subgraph_labeled_edge_label_belongs_to_outer_cluster_spec.mmd`
- HTML multiline edge labels: `fixtures/flowchart/upstream_flowchart_v2_stage2_html_multiline_edge_label_spec.mmd`
- isolated cluster with multiple labeled edges: `fixtures/flowchart/upstream_flowchart_v2_stage2_isolated_cluster_with_multiple_labeled_edges_contains_all_labels_spec.mmd`
- subgraph `direction` ignored when external edges exist: `fixtures/flowchart/upstream_flowchart_v2_stage2_subgraph_dir_ignored_when_has_external_edges_spec.mmd`
- long-word title wrapping in SVG-like mode: `fixtures/flowchart/upstream_flowchart_v2_stage2_subgraph_title_wraps_long_word_svglike_spec.mmd`

## SVG DOM parity notes (Flowchart v2)

These are upstream Mermaid `@11.12.2` behaviors worth calling out explicitly because they are
counter-intuitive and easy to break while refactoring:

- Rough.js PRNG stream continuity (even when `roughness: 0`):
  - flowchart-v2 uses Rough.js for certain shapes even in `look: "classic"` (it sets `roughness: 0`)
  - Rough.js still consumes randomness for `divergePoint` and other internal calls
  - for `generator.path(...)` with `fillStyle: "solid"` and `sets.length === 1`, the fill pass
    continues the same PRNG stream after the stroke pass (it reuses `o.randomizer`), so the fill
    path `d` is not generated from a fresh seed
- Dagre node sizing can be derived from rendered shape bbox (`updateNodeBounds(getBBox)`):
  - flowchart-v2 inserts node SVG first, then calls `updateNodeBounds(node, shapeElem)` and only
    then runs Dagre layout
  - for rough-path-based shapes (notably `stadium`), the rough path bbox can be narrower than the
    theoretical sizing formula used to generate its points, and this bbox width is what Dagre uses
    for spacing and x-positioning
- `htmlLabels` toggles:
  - node/subgraph labels follow the global `htmlLabels` toggle
  - edge labels follow `flowchart.htmlLabels` (falling back to the global toggle when unset)
- SVG-like labels (`htmlLabels: false`) render via `createText(..., useHtmlLabels=false)`:
  - text is split into word-level inner `<tspan class="text-inner-tspan">` runs, where non-first
    runs include a leading space (e.g. `"Get money"` becomes `"Get"` + `" money"`)
  - escaped HTML tag wrappers are tokenized into 3 runs even though they are still escaped (e.g.
    `"<strong>Haiya</strong>"` becomes `"<strong>"` + `" Haiya"` + `" </strong>"`)
  - edge labels with empty text still leave behind a bare `<g><rect class="background" style="stroke: none"/></g>`
    under `.edgeLabels` (one per empty label), due to the upstream `createText` return value
    being the `<text>` element while the wrapper `<g>` remains in the DOM
    - see: `fixtures/flowchart/upstream_flowchart_v2_subgraph_title_margins_lr_htmlLabels_false_spec.mmd`
    - see: `fixtures/flowchart/upstream_flowchart_v2_stadium_shape_spec.mmd` (one unlabeled edge)
- Sanitized `javascript:` click links in strict mode become `about:blank`, but the upstream SVG
  `<a>` wrapper carries no `xlink:href` attribute:
  - see: `fixtures/flowchart/upstream_linkstyle_and_click.mmd`

## Deferred / intentionally not snapshotted

- `parser/flow-huge.spec.js`: performance/stress coverage is deferred (headless functional parity is validated via smaller fixtures + unit tests).
