# Flowchart Upstream Test Coverage (Mermaid@11.12.2)

This document tracks which upstream Mermaid flowchart tests are covered in `merman` via:

- snapshot fixtures under `fixtures/flowchart/*.mmd` (goldens generated by `cargo run -p xtask -- update-snapshots`)
- Rust unit tests under `crates/merman-core/src/lib.rs`

Scope: Mermaid tag `@11.12.2`.

## Parser specs

### `parser/flow-comments.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-comments.spec.js`

- comments at start/middle/end + no trailing newline: `fixtures/flowchart/upstream_comments.mmd`
- comment containing mermaid-like tokens must not affect parsing: `fixtures/flowchart/upstream_comments.mmd`

### `parser/flow-arrows.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-arrows.spec.js`

- header direction shorthand (`graph >`, `<`, `^`, `v`): unit test `parse_diagram_flowchart_header_direction_shorthand` in `crates/merman-core/src/lib.rs`
- spaces around arrows + statements without trailing semicolons: unit tests like `parse_diagram_flowchart_basic_graph` and arrow-related tests
- multi-directional arrows (double-ended, thick, dotted): unit tests like `parse_diagram_flowchart_double_ended_arrows` and `parse_diagram_flowchart_edge_stroke_and_type_normal_thick_dotted`

### `parser/flow-edges.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-edges.spec.js`

- open/cross/circle-ended edges + pipe labels: `fixtures/flowchart/upstream_edges.mmd`
- edge ids + label handling + length matrix + keyword edge labels: unit tests:
  - `parse_diagram_flowchart_edges_spec_open_cross_circle`
  - `parse_diagram_flowchart_edges_spec_edge_ids_and_node_metadata_do_not_conflict`
  - `parse_diagram_flowchart_edges_spec_edge_length_matrix`
  - `parse_diagram_flowchart_edges_spec_keywords_as_edge_labels_in_double_ended_edges`

### `parser/flow-direction.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-direction.spec.js`

- subgraph direction statements (`direction BT|RL|LR` etc) and “last wins”: unit test `parse_diagram_flowchart_subgraph_direction_statement_sets_dir` in `crates/merman-core/src/lib.rs`
- nested subgraphs direction + membership rules: unit tests:
  - `parse_diagram_flowchart_supports_nested_subgraphs`
  - `parse_diagram_flowchart_subgraph_chain_membership_order_matches_mermaid`
- snapshot coverage of representative subgraph direction + nesting: `fixtures/flowchart/upstream_subgraphs.mmd`

### `parser/flow-md-string.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-md-string.spec.js`

- markdown strings in node + edge labels: `fixtures/flowchart/upstream_markdown_strings.mmd`
- markdown strings in subgraph titles: `fixtures/flowchart/upstream_markdown_subgraphs.mmd`

### `parser/flow-node-data.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-node-data.spec.js`

- shapeData statements (`@{...}`) basic + multiline label rewriting: `fixtures/flowchart/upstream_node_data_minimal.mmd`
- broader matrix + validation errors + edge-id metadata: unit tests:
  - `parse_diagram_flowchart_node_data_*`
  - `parse_diagram_flowchart_edge_curve_properties_using_edge_id`

### `parser/flow-style.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-style.spec.js`

- `style` / `classDef` / `class` + inline `:::Class` basics: `fixtures/flowchart/class_style.mmd`
- group behavior for `:::Class` + multiple classes/styles: unit tests:
  - `parse_diagram_flowchart_classdef_and_class_assign_work`
  - `parse_diagram_flowchart_inline_vertex_class_via_style_separator`
  - `parse_diagram_flowchart_inline_vertex_class_in_groups_matches_mermaid_style_spec`
  - `parse_diagram_flowchart_style_statement_supports_multiple_styles`
  - `parse_diagram_flowchart_classdef_supports_multiple_classes`

### `parser/flow-interactions.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/flow-interactions.spec.js`

- click href + tooltip + linkTarget: `fixtures/flowchart/subgraph_click.mmd`
- `javascript:` URL sanitization when `securityLevel != loose`: `fixtures/flowchart/upstream_linkstyle_and_click.mmd`
- callback parsing + `securityLevel` gating: unit tests:
  - `parse_diagram_flowchart_click_link_sets_link_and_tooltip_and_clickable_class`
  - `parse_diagram_flowchart_click_link_sanitizes_javascript_urls_when_not_loose`

### `parser/subgraph.spec.js`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/parser/subgraph.spec.js`

- subgraph syntaxes (title-only, explicit id + title, quoted titles, numeric ids): unit tests:
  - `parse_diagram_flowchart_supports_subgraph_block`
  - `parse_diagram_flowchart_subgraph_supports_explicit_id_and_title`
  - `parse_diagram_flowchart_subgraph_title_with_spaces_uses_auto_id`
  - `parse_diagram_flowchart_subgraph_title_with_spaces_in_quotes_uses_auto_id`
  - `parse_diagram_flowchart_subgraph_id_and_title_notation`
  - `parse_diagram_flowchart_subgraph_tab_indentation_matches_mermaid_membership_order`
- snapshot coverage of representative variants + nesting: `fixtures/flowchart/upstream_subgraphs.mmd`

## DB / renderer specs

### `flowDb.spec.ts`

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/flowDb.spec.ts`

- `linkStyle` interpolate (`default` and numbered): `fixtures/flowchart/upstream_linkstyle_and_click.mmd` and unit tests:
  - `parse_diagram_flowchart_linkstyle_default_interpolate_sets_edge_defaults`
  - `parse_diagram_flowchart_linkstyle_numbered_interpolate_sets_edges`
  - `parse_diagram_flowchart_linkstyle_multi_numbered_interpolate_sets_edges`
- subgraph membership ordering parity (FlowDB semantics): unit tests under `parse_diagram_flowchart_subgraph_*`

### `flowChartShapes.spec.js` (rendering)

Source: `repo-ref/mermaid/packages/mermaid/src/diagrams/flowchart/flowChartShapes.spec.js`

- rendering-only (SVG shape geometry) and out of scope for headless parsing parity.

## Deferred / intentionally not snapshotted

- `parser/flow-huge.spec.js`: performance/stress coverage is deferred (headless functional parity is validated via smaller fixtures + unit tests).

